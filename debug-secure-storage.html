<!DOCTYPE html>
<html>
<head>
    <title>Auto-Login Debug Test</title>
</head>
<body>
    <h1>Auto-Login Debug Test</h1>
    <div id="output"></div>
    
    <script>
        // Simulate the auto-login response
        const mockResponse = {
            "message": "Auto-login successful",
            "redirect_url": "/profile?token=test_token",
            "access_token": "test_access_token",
            "user": {
                "id": "68cdb43f8f5a41b900e57548",
                "name": "Nivo music",
                "email": "nivroz93@gmail.com",
                "avatar_url": "https://lh3.googleusercontent.com/a/ACg8ocLFHY0QfVwsm-Ib8383tdEmHEe8SBUL77gwlxr31OLb_4xZ49o6=s96-c",
                "bio": null,
                "provider": "google",
                "mfa_enabled": false,
                "status": "active",
                "created_at": "2025-09-19T19:51:27.357000",
                "last_login": "2025-09-26T18:51:32.910000",
                "liked_products": [],
                "liked_products_count": 0,
                "purchased_products_count": 1,
                "billing_address": {},
                "company_name": null,
                "phone_number": null,
                "vat_number": null,
                "email_verified": true
            }
        };
        
        // Test secureStorage
        function testSecureStorage() {
            const output = document.getElementById('output');
            output.innerHTML = '<h2>Testing SecureStorage...</h2>';
            
            try {
                // Simple localStorage test
                localStorage.setItem('test_user', JSON.stringify(mockResponse.user));
                const retrieved = JSON.parse(localStorage.getItem('test_user'));
                
                output.innerHTML += `
                    <p>✅ localStorage test successful</p>
                    <p>User name: ${retrieved.name}</p>
                    <p>User email: ${retrieved.email}</p>
                    <p>User ID: ${retrieved.id}</p>
                `;
                
                // Test if the issue is with the secureStorage implementation
                output.innerHTML += '<h3>Testing secureStorage simulation...</h3>';
                
                // Simulate what secureStorage should do
                const userData = mockResponse.user;
                const encryptedData = JSON.stringify(userData); // Simplified
                localStorage.setItem('secure_user', encryptedData);
                
                const decryptedData = JSON.parse(localStorage.getItem('secure_user'));
                output.innerHTML += `
                    <p>✅ secureStorage simulation successful</p>
                    <p>Decrypted name: ${decryptedData.name}</p>
                    <p>Decrypted email: ${decryptedData.email}</p>
                `;
                
            } catch (error) {
                output.innerHTML += `<p>❌ Error: ${error.message}</p>`;
            }
        }
        
        // Run the test
        testSecureStorage();
    </script>
</body>
</html>
